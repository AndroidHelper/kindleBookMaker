<!DOCTYPE html>
<html>
<head>
  
  <title>&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5C3D;&#x5FEB;&#x652F;&#x6301; ALPN&#xFF1F;</title>
  
</head>
<body>

<div id="wrap">
  <h1>&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x5C3D;&#x5FEB;&#x652F;&#x6301; ALPN&#xFF1F;</h1>
  <div id="content"><p>&#x6628;&#x5929;&#x6709;&#x4F4D;&#x670B;&#x53CB;&#x5728;&#x5FAE;&#x4FE1;&#x4E0A;&#x53D1;&#x8FC7;&#x6765;&#x4E00;&#x4E2A;&#x94FE;&#x63A5;&#xFF1A;<a href="https://ma.ttias.be/day-google-chrome-disables-http2-nearly-everyone-may-31st-2016/">The day Google Chrome disables HTTP/2 for nearly everyone: May 31st, 2016</a>&#xFF08;<a href="http://www.zcfy.cc/article/288">&#x4E2D;&#x6587;&#x7FFB;&#x8BD1;</a>&#xFF09;&#x3002;&#x770B;&#x6807;&#x9898;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x8BF4;&#x7684;&#x662F; Google Chrome &#x5373;&#x5C06;&#x5927;&#x9762;&#x79EF;&#x7981;&#x7528; HTTP/2&#xFF0C;&#x8FD9;&#x7A76;&#x7ADF;&#x662F;&#x600E;&#x4E48;&#x56DE;&#x4E8B;&#x5462;&#xFF1F;&#x672C;&#x6587;&#x4E3A;&#x4F60;&#x63ED;&#x6653;&#x7B54;&#x6848;&#x3002;</p>
<p>&#x5148;&#x6765;&#x56DE;&#x987E;&#x4E00;&#x4E0B;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5728;&#x8BBF;&#x95EE; HTTPS &#x7F51;&#x7AD9;&#x65F6;&#xFF0C;&#x5982;&#x4F55;&#x5F97;&#x77E5;&#x670D;&#x52A1;&#x7AEF;&#x662F;&#x5426;&#x652F;&#x6301; HTTP/2&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x501F;&#x52A9; HTTP/2 &#x7684;&#x534F;&#x8BAE;&#x534F;&#x5546;&#x673A;&#x5236;&#xFF1A;&#x5728; HTTP/2 Over HTTP &#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; HTTP &#x7684; Upgrade &#x673A;&#x5236;&#x8FDB;&#x884C;&#x534F;&#x5546;&#xFF1B;&#x800C;&#x5BF9;&#x4E8E; HTTP/2 Over TLS&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; TLS &#x7684; NPN &#x6216; ALPN &#x6269;&#x5C55;&#x6765;&#x5B8C;&#x6210;&#x534F;&#x5546;&#x3002;HTTP/2 &#x7684;&#x8FD9;&#x4E24;&#x79CD;&#x534F;&#x5546;&#x65B9;&#x5F0F;&#xFF0C;&#x4E0D;&#x4E86;&#x89E3;&#x7684;&#x540C;&#x5B66;&#x8BF7;&#x770B;&#x300A;<a href="https://imququ.com/post/protocol-negotiation-in-http2.html">&#x8C08;&#x8C08; HTTP/2 &#x7684;&#x534F;&#x8BAE;&#x534F;&#x5546;&#x673A;&#x5236;</a>&#x300B;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x8D58;&#x8FF0;&#x3002;</p>
<p>&#x5F53;&#x524D;&#x6240;&#x6709;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x90FD;&#x53EA;&#x652F;&#x6301; HTTP/2 Over TLS&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x90FD;&#x652F;&#x6301; NPN &#x6216; ALPN &#x534F;&#x5546;&#xFF0C;&#x662F;&#x7528;&#x4E0A; HTTP/2 &#x7684;&#x5927;&#x524D;&#x63D0;&#x3002;&#x672C;&#x6587;&#x91CD;&#x70B9;&#x8BA8;&#x8BBA; NPN &#x548C; ALPN&#x3002;</p>
<p>NPN&#xFF08;Next Protocol Negotiation&#xFF0C;&#x4E0B;&#x4E00;&#x4EE3;&#x534F;&#x8BAE;&#x534F;&#x5546;&#xFF09;&#xFF0C;&#x662F;&#x4E00;&#x4E2A; TLS &#x6269;&#x5C55;&#xFF0C;&#x7531; Google &#x5728;&#x5F00;&#x53D1; SPDY &#x534F;&#x8BAE;&#x65F6;&#x63D0;&#x51FA;&#x3002;&#x968F;&#x7740; SPDY &#x88AB; HTTP/2 &#x53D6;&#x4EE3;&#xFF0C;NPN &#x4E5F;&#x88AB;&#x4FEE;&#x8BA2;&#x4E3A; ALPN&#xFF08;Application Layer Protocol Negotiation&#xFF0C;&#x5E94;&#x7528;&#x5C42;&#x534F;&#x8BAE;&#x534F;&#x5546;&#xFF09;&#x3002;&#x4E8C;&#x8005;&#x76EE;&#x6807;&#x4E00;&#x81F4;&#xFF0C;&#x4F46;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x76F8;&#x4E92;&#x4E0D;&#x517C;&#x5BB9;&#x3002;&#x4EE5;&#x4E0B;&#x662F;&#x5B83;&#x4EEC;&#x4E3B;&#x8981;&#x5DEE;&#x522B;&#xFF1A;</p>
<ul>
<li>NPN &#x662F;&#x670D;&#x52A1;&#x7AEF;&#x53D1;&#x9001;&#x6240;&#x652F;&#x6301;&#x7684; HTTP &#x534F;&#x8BAE;&#x5217;&#x8868;&#xFF0C;&#x7531;&#x5BA2;&#x6237;&#x7AEF;&#x9009;&#x62E9;&#xFF1B;&#x800C; ALPN &#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x6240;&#x652F;&#x6301;&#x7684; HTTP &#x534F;&#x8BAE;&#x5217;&#x8868;&#xFF0C;&#x7531;&#x670D;&#x52A1;&#x7AEF;&#x9009;&#x62E9;&#xFF1B;</li>
<li>NPN &#x7684;&#x534F;&#x5546;&#x7ED3;&#x679C;&#x662F;&#x5728; Change Cipher Spec &#x4E4B;&#x540E;&#x52A0;&#x5BC6;&#x53D1;&#x9001;&#x7ED9;&#x670D;&#x52A1;&#x7AEF;&#xFF1B;&#x800C; ALPN &#x7684;&#x534F;&#x5546;&#x7ED3;&#x679C;&#x662F;&#x901A;&#x8FC7; Server Hello &#x660E;&#x6587;&#x53D1;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#xFF1B;</li>
</ul>
<p>&#x5927;&#x90E8;&#x5206; Web Server &#x90FD;&#x4F9D;&#x8D56; OpenSSL &#x5E93;&#x63D0;&#x4F9B; HTTPS &#x670D;&#x52A1;&#xFF0C;&#x5BF9;&#x4E8E;&#x5B83;&#x4EEC;&#x6765;&#x8BF4;&#xFF0C;&#x662F;&#x5426;&#x652F;&#x6301; NPN &#x6216; ALPN &#x5B8C;&#x5168;&#x53D6;&#x51B3;&#x4E8E;&#x4F7F;&#x7528;&#x7684; OpenSSL &#x7248;&#x672C;&#x3002;&#x901A;&#x5E38;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x4E0D;&#x7279;&#x610F;&#x6307;&#x5B9A; OpenSSL &#x76EE;&#x5F55;&#xFF0C;Web Server &#x4F1A;&#x4F7F;&#x7528;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5185;&#x7F6E;&#x7684; OpenSSL &#x5E93;&#x3002;</p>
<p>OpenSSL 1.0.2 &#x5F00;&#x59CB;&#x652F;&#x6301; ALPN&#xFF0C;&#x5F53;&#x524D;&#x4E3B;&#x6D41;&#x670D;&#x52A1;&#x5668;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x57FA;&#x672C;&#x90FD;&#x6CA1;&#x6709;&#x5185;&#x7F6E;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x3002;&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4EFD;&#x7C97;&#x7565;&#x7684;&#x7EDF;&#x8BA1;&#xFF1A;</p>
<table>
<thead>
<tr>
<th style="text-align:left">&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;</th>
<th style="text-align:left">&#x5185;&#x7F6E; OpenSSL &#x7248;&#x672C;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">CentOS 5</td>
<td style="text-align:left">0.9.8e</td>
</tr>
<tr>
<td style="text-align:left">CentOS 6</td>
<td style="text-align:left">1.0.1e</td>
</tr>
<tr>
<td style="text-align:left">CentOS 7</td>
<td style="text-align:left">1.0.1e</td>
</tr>
<tr>
<td style="text-align:left">Ubuntu 14.04 LTS</td>
<td style="text-align:left">1.0.1f</td>
</tr>
<tr>
<td style="text-align:left">Ubuntu 16.04 LTS</td>
<td style="text-align:left"><strong>1.0.2g</strong></td>
</tr>
<tr>
<td style="text-align:left">Debian 7 (Wheezy)</td>
<td style="text-align:left">1.0.1e</td>
</tr>
<tr>
<td style="text-align:left">Debian 8 (Jessie)</td>
<td style="text-align:left">1.0.1k</td>
</tr>
</tbody>
</table>
<p>&#x8FD9;&#x4EFD;&#x8868;&#x683C;&#x5217;&#x4E3E;&#x7684;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x53EA;&#x6709;&#x6700;&#x8FD1;&#x521A;&#x53D1;&#x5E03;&#x7684; Ubuntu 16.04 &#x624D;&#x5185;&#x7F6E;&#x4E86;&#x652F;&#x6301; ALPN &#x7684; OpenSSL 1.0.2&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF; OpenSSL &#x5E93;&#x7684; Web Server&#xFF0C;&#x6781;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x652F;&#x6301; ALPN &#x6269;&#x5C55;&#x3002;</p>
<p>&#x53BB;&#x5E74;&#xFF0C;Google &#x5728; Chrome 47 &#x4E2D;&#x79FB;&#x9664;&#x4E86;&#x5BF9; NPN &#x7684;&#x652F;&#x6301;&#xFF0C;&#x53EA;&#x652F;&#x6301; ALPN&#xFF0C;&#x4F46;&#x5F88;&#x5FEB;&#x5C31;&#x5F15;&#x53D1;&#x4E00;&#x5927;&#x6279; HTTP/2 &#x7F51;&#x7AD9;&#x7684;&#x62B1;&#x6028;&#x3002;&#x6700;&#x7EC8;&#xFF0C;Google &#x4E0D;&#x5F97;&#x4E0D;&#x5728;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x7248;&#x672C;&#x4E2D;&#x53C8;<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=557197">&#x91CD;&#x65B0;&#x542F;&#x7528;&#x4E86; NPN</a>&#x3002;</p>
<p>&#x534A;&#x5E74;&#x540E;&#x7684;&#x4ECA;&#x5929;&#xFF0C;Google &#x53C8;&#x4E00;&#x6B21;&#x51B3;&#x5B9A;&#x5728; Chrome 51 &#x4E2D;&#x79FB;&#x9664; NPN&#xFF0C;&#x9884;&#x8BA1; 5 &#x6708;&#x5E95;&#x53D1;&#x5E03;&#x3002;&#x8FD9;&#x4E00;&#x6B21;&#x6050;&#x6015;&#x4E0D;&#x4F1A;&#x518D;&#x53CD;&#x6094;&#x4E86;&#x3002;</p>
<p>&#x672C;&#x6587;&#x5F00;&#x5934;&#x90A3;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x4F5C;&#x8005;&#x60B2;&#x89C2;&#x5730;&#x8BA4;&#x4E3A;&#xFF1A;&#x73B0;&#x5728; OpenSSL 1.0.2 &#x7684;&#x666E;&#x53CA;&#x7A0B;&#x5EA6;&#x4ECD;&#x7136;&#x592A;&#x4F4E;&#xFF0C;Chrome &#x73B0;&#x5728;&#x53BB;&#x6389;&#x5BF9; NPN &#x7684;&#x652F;&#x6301;&#xFF0C;&#x4ECD;&#x7136;&#x4F1A;&#x5BFC;&#x81F4;&#x4E00;&#x5927;&#x6279;&#x4E0D;&#x652F;&#x6301; ALPN &#x7684; HTTP/2 &#x7F51;&#x7AD9;&#x6700;&#x7EC8;&#x65E0;&#x6CD5;&#x534F;&#x5546;&#x5230; HTTP/2&#xFF0C;&#x53EA;&#x80FD;&#x964D;&#x7EA7;&#x4F7F;&#x7528; HTTP/1.1&#x3002;</p>
<p>&#x5BF9;&#x6B64;&#xFF0C;&#x6211;&#x7684;&#x89C2;&#x70B9;&#x662F;&#xFF0C;&#x8BE5;&#x6765;&#x7684;&#x603B;&#x4F1A;&#x6765;&#xFF0C;&#x65E2;&#x7136;&#x4E0D;&#x80FD;&#x6539;&#x53D8;&#x7ED3;&#x679C;&#xFF0C;&#x4E0D;&#x5982;&#x65E9;&#x505A;&#x51C6;&#x5907;&#x3002;</p>
<p>&#x901A;&#x8FC7; OpenSSL &#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;&#xFF0C;&#x53EF;&#x4EE5;&#x5FEB;&#x901F;&#x67E5;&#x770B;&#x81EA;&#x5DF1;&#x7684; HTTP/2 &#x670D;&#x52A1;&#x662F;&#x5426;&#x652F;&#x6301; ALPN &#x6269;&#x5C55;&#xFF1A;</p>
<pre><code class="lang-bash">openssl s_client -alpn h2 -servername imququ.com -connect imququ.com:<span class="hljs-number">443</span> &lt; /dev/null | grep <span class="hljs-string">&apos;ALPN&apos;</span>
</code></pre>
<p>&#x5982;&#x679C;&#x63D0;&#x793A; <code>unknown option -alpn</code>&#xFF0C;&#x8BF4;&#x660E;&#x672C;&#x5730;&#x7684; OpenSSL &#x7248;&#x672C;&#x592A;&#x4F4E;&#xFF08;&#x53EF;&#x901A;&#x8FC7; <code>openssl version</code> &#x67E5;&#x770B;&#xFF09;&#xFF0C;&#x8BF7;&#x5347;&#x7EA7;&#x5230; 1.0.2+&#x3002;&#x5982;&#x679C;&#x4E0D;&#x65B9;&#x4FBF;&#x5347;&#x7EA7;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <a href="https://www.ssllabs.com/ssltest/index.html">Qualys SSL Labs&apos;s SSL Server Test</a> &#x8FD9;&#x4E2A;&#x5728;&#x7EBF;&#x5DE5;&#x5177;&#x6765;&#x6D4B;&#x8BD5;&#x3002;</p>
<p>&#x5982;&#x679C;&#x7ED3;&#x679C;&#x5305;&#x542B; <code>ALPN protocol: h2</code>&#xFF0C;&#x8BF4;&#x660E;&#x670D;&#x52A1;&#x7AEF;&#x652F;&#x6301; ALPN&#xFF0C;&#x4E0D;&#x53D7; Chrome 51 &#x53BB;&#x6389; NPN &#x7684;&#x5F71;&#x54CD;&#x3002;</p>
<p>&#x5982;&#x679C;&#x7ED3;&#x679C;&#x5305;&#x542B; <code>No ALPN negotiated</code>&#xFF0C;&#x8BF4;&#x660E;&#x670D;&#x52A1;&#x7AEF;&#x4E0D;&#x652F;&#x6301; ALPN&#xFF0C;&#x5728; Chrome 51 &#x4E2D;&#x65E0;&#x6CD5;&#x534F;&#x5546;&#x5230; HTTP/2&#xFF0C;&#x9700;&#x8981;&#x5C3D;&#x5FEB;&#x5347;&#x7EA7;&#x3002;</p>
<p>&#x7531;&#x4E8E; OpenSSL &#x662F;&#x7CFB;&#x7EDF;&#x57FA;&#x7840;&#x5E93;&#xFF0C;&#x5927;&#x91CF;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x90FD;&#x5BF9;&#x5B83;&#x6709;&#x4F9D;&#x8D56;&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x5347;&#x7EA7;&#x7CFB;&#x7EDF;&#x81EA;&#x5E26;&#x7684; OpenSSL&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5F15;&#x53D1;&#x5404;&#x79CD;&#x95EE;&#x9898;&#x3002;&#x66F4;&#x4E3A;&#x7A33;&#x59A5;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x5728;&#x7F16;&#x8BD1; Web Server &#x65F6;&#x81EA;&#x5DF1;&#x6307;&#x5B9A; OpenSSL &#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x6211;&#x5728;&#x300A;<a href="https://imququ.com/post/my-nginx-conf.html#toc-0">&#x672C;&#x535A;&#x5BA2; Nginx &#x914D;&#x7F6E;&#x4E4B;&#x5B8C;&#x6574;&#x7BC7;</a>&#x300B;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#x63D0;&#x4F9B;&#x7684; Nginx &#x7F16;&#x8BD1;&#x6B65;&#x9AA4;&#x4E2D;&#xFF0C;&#x5C31;&#x901A;&#x8FC7; <code>--with-openssl</code> &#x6307;&#x5B9A;&#x4E86;&#x65B0;&#x7248; OpenSSL &#x6E90;&#x7801;&#x8DEF;&#x5F84;&#xFF0C;&#x8FD9;&#x6837;&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684; Nginx &#x5C31;&#x4F1A;&#x7528;&#x4E0A;&#x6700;&#x65B0;&#x7684; OpenSSL &#x5E93;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4F60;&#x5728;&#x7528; LibreSSL &#x505A;&#x4E3A; Web Server &#x7684; SSL &#x5E93;&#xFF0C;&#x9700;&#x8981;&#x5347;&#x7EA7;&#x5230; 2.1.3+ &#x624D;&#x652F;&#x6301; ALPN&#x3002;</p>
<p><a href="https://github.com/square/okhttp">OkHttp</a> &#x662F;&#x4E00;&#x4E2A; Android &#x4E0B;&#x6BD4;&#x8F83;&#x5E38;&#x7528;&#x7684; HTTP &#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x652F;&#x6301; HTTP &#x548C; HTTP/2 &#x534F;&#x8BAE;&#x3002;&#x5B83;&#x5728;&#x4E00;&#x5E74;&#x524D;&#x4E5F;<a href="https://github.com/square/okhttp/pull/1201">&#x79FB;&#x9664;&#x4E86;&#x5BF9; NPN &#x7684;&#x652F;&#x6301;</a>&#xFF0C;&#x6240;&#x4EE5;&#x652F;&#x6301; HTTP/2 &#x4F46;&#x4E0D;&#x652F;&#x6301; ALPN &#x7684;&#x7F51;&#x7AD9;&#xFF0C;&#x5728; OkHttp &#x5BA2;&#x6237;&#x7AEF;&#x4E2D;&#x4F1A;&#x964D;&#x7EA7;&#x5230; HTTP/1.1&#x3002;</p>
<p>Chrome 51 &#x8FD9;&#x6B21;&#x4E5F;&#x4F1A;<a href="https://developers.google.com/web/updates/2016/04/chrome-51-deprecations#remove-support-for-spdy31">&#x5F7B;&#x5E95;&#x79FB;&#x9664;&#x5BF9; SPDY &#x7684;&#x652F;&#x6301;</a>&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684;&#x7F51;&#x7AD9;&#x8FD8;&#x53EA;&#x652F;&#x6301; SPDY&#xFF0C;&#x8D81;&#x8FD9;&#x4E2A;&#x673A;&#x4F1A;&#x76F4;&#x63A5;&#x5347;&#x7EA7;&#x5230; HTTP/2 + ALPN &#x5427;&#x3002;</p>
<p>&#x672C;&#x6587;&#x94FE;&#x63A5;&#xFF1A;<a href="https://imququ.com/post/enable-alpn-asap.html">https://imququ.com/post/enable-alpn-asap.html</a>&#xFF0C;<a href="https://imququ.com/post/enable-alpn-asap.html#comments" target="_blank">&#x53C2;&#x4E0E;&#x8BA8;&#x8BBA;</a></p><p>&#x2665; &#x672C;&#x7AD9;&#x6240;&#x6709;&#x6587;&#x7AE0;&#x5747;&#x4E3A;&#x672C;&#x4EBA;&#x539F;&#x521B;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8BA4;&#x4E3A;&#x6211;&#x7684;&#x6587;&#x7AE0;&#x5BF9;&#x4F60;&#x6709;&#x5E2E;&#x52A9;&#xFF0C;&#x6B22;&#x8FCE;&#x8D5E;&#x52A9;&#x672C;&#x7AD9;&#x3002;<a target="_blank" href="https://imququ.com/post/about.html#toc-2">&#x8BE6;&#x60C5;&#x8BF7;&#x70B9;&#x8FD9;&#x91CC; &#xBB;</a></p></div>
</div>

</body>
</html>